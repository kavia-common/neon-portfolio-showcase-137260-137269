# Supabase Integration Notes

This frontend uses a client-side Supabase connection for a realtime contact form.

Environment variables (must be provided via deployment environment or local .env):
- REACT_APP_SUPABASE_URL
- REACT_APP_SUPABASE_KEY

Do NOT hardcode keys in the codebase. The React app reads these variables at build time.

Contact messages table schema (live configuration):
```sql
create table if not exists public.contact_messages (
  id bigint generated by default as identity primary key,
  name text not null,
  email text not null,
  message text not null,
  created_at timestamp with time zone default now()
);
```

Row Level Security (RLS) and Realtime:
- RLS enabled on `public.contact_messages`.
- Policies applied:
  - `contact_messages_insert_anon`: allows INSERTs from the `anon` role.
  - `contact_messages_read_all`: allows SELECT for all (intended for simple demo feeds).
- The table is added to the `supabase_realtime` publication for realtime events.
- You should also ensure Realtime is enabled in Dashboard: Database -> Replication -> supabase_realtime -> enable for `public.contact_messages`.

Policy SQL (idempotent pattern used in setup):
```sql
alter table public.contact_messages enable row level security;

-- Insert for anon
do $$ begin
  if not exists (
    select 1 from pg_policies
    where schemaname = 'public'
      and tablename = 'contact_messages'
      and policyname = 'contact_messages_insert_anon'
  ) then
    create policy contact_messages_insert_anon on public.contact_messages
      for insert to anon
      with check (true);
  end if;
end $$;

-- Select for all
do $$ begin
  if not exists (
    select 1 from pg_policies
    where schemaname = 'public'
      and tablename = 'contact_messages'
      and policyname = 'contact_messages_read_all'
  ) then
    create policy contact_messages_read_all on public.contact_messages
      for select using (true);
  end if;
end $$;

-- Realtime
do $$
begin
  if not exists (
    select 1
    from pg_publication_tables
    where pubname = 'supabase_realtime'
      and schemaname = 'public'
      and tablename = 'contact_messages'
  ) then
    alter publication supabase_realtime add table public.contact_messages;
  end if;
end$$;
```

Frontend integration (already implemented):
- Supabase client is created in `src/supabaseClient.js` using:
  - `REACT_APP_SUPABASE_URL`
  - `REACT_APP_SUPABASE_KEY`
- The Contact form inserts rows to `public.contact_messages` with fields:
  - `name` (text, required)
  - `email` (text, required)
  - `message` (text, required)
  - `created_at` (default now())
- Realtime subscription listens for INSERT events:
  - schema: `public`
  - table: `contact_messages`
  - channel: `contact_messages_inserts`

Local .env setup:
- Copy `.env.example` to `.env` in `portfolio_frontend/` and set values:
```
REACT_APP_SUPABASE_URL=YOUR_SUPABASE_URL
REACT_APP_SUPABASE_KEY=YOUR_SUPABASE_ANON_PUBLIC_KEY
```

Security notes:
- Keep the service role key out of the client. Use the anon public key for client-side apps.
- If you need to restrict reads (e.g., hide other usersâ€™ messages), replace `contact_messages_read_all` with a more restrictive policy or proxy reads via a backend.
- Consider adding basic rate limiting or captcha in production to reduce spam.

Optional Auth:
- If enabling email-based flows, also configure:
  - REACT_APP_SITE_URL (used for `emailRedirectTo` when needed)
- Add your development and production URLs to Authentication > URL Configuration in the Supabase Dashboard.
